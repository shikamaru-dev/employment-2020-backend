(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{448:function(t,e,r){"use strict";r.r(e);r(71),r(39),r(43);var n,o,c,d,l=r(15),h=r(415),m=r(52),f={data:function(){return{department:null,current:null,next:null,userList:[],currentCandidates:[],nextCandidates:[],imageName:"",imageUrl:"",dialog:!1,loading:!1,priority:0,count:0,docId:"",headers:[{sortable:!1},{text:"DocumentId",value:"docId",sortable:!1},{text:"displayName",value:"displayName",sortable:!1},{text:"priority",value:"priority",sortable:!1},{text:"count",value:"count",sortable:!1},{sortable:!1}]}},asyncData:(d=Object(l.a)(regeneratorRuntime.mark((function t(e){var r,n,o,c,d,l,h,f,v,x,y,_,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.firestore().collection("departments").doc(e.params.id).get();case 2:return r=t.sent,t.next=5,m.a.firestore().collection("candidates").doc(e.params.id).get();case 5:return n=t.sent,t.next=8,m.a.firestore().collection("currents").doc(e.params.id).get();case 8:return o=t.sent,t.next=11,m.a.firestore().collection("nexts").doc(e.params.id).get();case 11:return c=t.sent,t.next=14,m.a.firestore().collection("lists").where("department","==",r.ref).orderBy("priority","asc").get();case 14:return d=t.sent,t.next=17,m.a.functions().httpsCallable("users")({userIds:[]});case 17:return l=t.sent,h={},l.data.users.map((function(t){h[t.uid]=t})),f=[],d.forEach((function(t){var u=Object.create(h[t.data().user.id]);u.docId=t.id,u.priority=t.data().priority,u.count=t.data().count,f.push(u)})),v="未定",x="未定",o.exists&&(v=h[o.data().user.id].displayName),c.exists&&(x=h[c.data().user.id].displayName),y=n.data().currents.map((function(t){return Object.create(h[t.id])})),_=n.data().nexts.map((function(t){return Object.create(h[t.id])})),k=r.data(),t.abrupt("return",{department:k,currentCandidates:y,nextCandidates:_,userList:f,usersMap:h,current:v,next:x});case 30:case"end":return t.stop()}}),t)}))),function(t){return d.apply(this,arguments)}),mounted:function(){this.$nextTick((function(){new h.a(this.$refs.sortableTable.$el.getElementsByTagName("tbody")[0],{draggable:".sortableRow",handle:".sortHandle",onEnd:this.dragReorder})}))},methods:{dragReorder:function(t){var e=t.oldIndex,r=t.newIndex,n=this.userList.splice(e,1)[0],o=m.a.firestore().collection("lists").doc(n.docId),c=0,d=1;r>0&&(c=this.userList[r-1].priority),r<this.userList.length&&(d=this.userList[r].priority);var l=(c+d)/2;n.priority=l,o.set({priority:l},{merge:!0}),this.userList.splice(r,0,n)},openDialog:function(data){this.priority=data.priority,this.count=data.count,this.docId=data.docId,this.dialog=!0},clickCancel:function(){this.dialog=!1},clickRegist:(c=Object(l.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,e=m.a.firestore().collection("lists"),t.next=4,e.doc(this.docId).set({priority:this.priority,count:this.count},{merge:!0});case 4:return t.next=6,m.a.firestore().collection("changedFlags").doc(this.$route.params.id).set({department:m.a.firestore().collection("departments").doc(this.$route.params.id)});case 6:return t.next=8,this.resolveData();case 8:this.dialog=!1,this.loading=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)}),clickDelete:(o=Object(l.a)(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.dialog=!0,r=m.a.firestore().collection("lists"),t.next=5,r.doc(e).delete();case 5:return t.next=7,m.a.firestore().collection("changedFlags").doc(this.$route.params.id).set({department:m.a.firestore().collection("departments").doc(this.$route.params.id)});case 7:return t.next=9,this.resolveData();case 9:this.dialog=!1,this.loading=!1;case 11:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)}),resolveData:(n=Object(l.a)(regeneratorRuntime.mark((function t(){var e,r,n,o,c,d,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.a.firestore().collection("departments").doc(this.$route.params.id).get();case 2:return e=t.sent,t.next=5,m.a.firestore().collection("candidates").doc(this.$route.params.id).get();case 5:return r=t.sent,t.next=8,m.a.firestore().collection("lists").where("department","==",e.ref).orderBy("priority","asc").get();case 8:n=t.sent,o=[],n.forEach((function(t){var u=Object.create(l.usersMap[t.data().user.id]);u.docId=t.id,u.priority=t.data().priority,u.count=t.data().count,o.push(u)})),c=r.data().currents.map((function(t){return Object.create(l.usersMap[t.id])})),d=r.data().nexts.map((function(t){return Object.create(l.usersMap[t.id])})),this.currentCandidates=c,this.nextCandidates=d,this.userList=o;case 16:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)}),onFilePickedMon:function(t){this.onFilePicked(t,"Mon")},onFilePickedTue:function(t){this.onFilePicked(t,"Tue")},onFilePickedWed:function(t){this.onFilePicked(t,"Wed")},onFilePickedThu:function(t){this.onFilePicked(t,"Thu")},onFilePickedFri:function(t){this.onFilePicked(t,"Fri")},onFilePicked:function(t,e){var r=this,n=t[0];if(void 0!==n){if(this.imageName=n.name,this.imageName.lastIndexOf(".")<=0)return;var o=this.imageName.split(".").pop();m.a.storage().ref().child("images/".concat(this.$route.params.id,"/").concat(e,".").concat(o)).put(n).then((function(t){t.ref.getDownloadURL().then((function(t){r.imageUrl=t}))}))}}}},v=r(62),x=r(83),y=r.n(x),_=r(133),k=r(350),w=r(327),C=r(320),F=r(436),P=r(431),I=r(433),R=r(125),T=r(352),V=r(338),D=r(324),N=r(339),component=Object(v.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("h1",[t._v("掃除種別詳細："+t._s(t.department.name))]),r("br"),r("v-simple-table",[r("tr",[r("th",[t._v("本日")]),r("td",[t._v(t._s(t.current))])]),r("tr",[r("th",[t._v("翌営業日")]),r("td",[t._v(t._s(t.next))])])]),r("br"),r("h2",[t._v("画像のアップロード")]),r("v-file-input",{attrs:{chips:"",multiple:"",label:"月曜日",accept:"image/*"},on:{change:t.onFilePickedMon}}),r("v-file-input",{attrs:{chips:"",multiple:"",label:"火曜日",accept:"image/*"},on:{change:t.onFilePickedTue}}),r("v-file-input",{attrs:{chips:"",multiple:"",label:"水曜日",accept:"image/*"},on:{change:t.onFilePickedWed}}),r("v-file-input",{attrs:{chips:"",multiple:"",label:"木曜日",accept:"image/*"},on:{change:t.onFilePickedThu}}),r("v-file-input",{attrs:{chips:"",multiple:"",label:"金曜日",accept:"image/*"},on:{change:t.onFilePickedFri}}),r("br"),r("h2",[t._v("リスト")]),[r("v-data-table",{ref:"sortableTable",staticClass:"elevation-1",attrs:{headers:t.headers,items:t.userList},scopedSlots:t._u([{key:"body",fn:function(e){var n=e.items;return[r("tbody",t._l(n,(function(e){return r("tr",{key:e.docId,staticClass:"sortableRow"},[r("td",{staticClass:"px-1",staticStyle:{width:"0.1%"}},[r("v-btn",{staticClass:"sortHandle",staticStyle:{cursor:"move"},attrs:{icon:""}},[r("v-icon",[t._v("mdi-menu")])],1)],1),r("td",[t._v(t._s(e.docId))]),r("td",[t._v(t._s(e.displayName))]),r("td",[t._v(t._s(e.priority))]),r("td",[t._v(t._s(e.count))]),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),t.openDialog(e)}}},[r("v-icon",[t._v("mdi-pencil")])],1)],1),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),t.clickDelete(e.docId)}}},[r("v-icon",[t._v("mdi-delete")])],1)],1)])})),0)]}}])})],r("br"),r("h2",[t._v("今日の掃除候補"),r("v-simple-table",t._l(t.currentCandidates,(function(e,n){return r("tr",{key:e.uid},[r("td",[t._v(t._s(n))]),r("td",[r("nuxt-link",{attrs:{to:{name:"users-id",params:{id:e.uid}}}},[t._v(t._s(e.uid))])],1),r("td",[t._v(t._s(e.displayName))])])})),0)],1),r("br"),r("h2",[t._v("明日の掃除候補"),r("v-simple-table",t._l(t.nextCandidates,(function(e,n){return r("tr",{key:e.uid},[r("td",[t._v(t._s(n))]),r("td",[r("nuxt-link",{attrs:{to:{name:"users-id",params:{id:e.uid}}}},[t._v(t._s(e.uid))])],1),r("td",[t._v(t._s(e.displayName))])])})),0)],1),r("v-dialog",{attrs:{"max-width":"720",persistent:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[r("v-card",[r("v-card-title",[r("div",{staticClass:"headline"},[t._v("編集")])]),t.loading?t._e():r("v-card-text",[r("v-container",[r("v-text-field",{attrs:{type:"number",label:"priority",hint:"優先度",required:""},model:{value:t.priority,callback:function(e){t.priority=e},expression:"priority"}}),r("v-text-field",{attrs:{type:"number",label:"count",hint:"掃除回数",required:""},model:{value:t.count,callback:function(e){t.count=e},expression:"count"}})],1)],1),t.loading?r("v-card-text",[t._v("Please stand by"),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1):t._e(),t.loading?t._e():r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(e){return t.clickCancel()}}},[t._v("キャンセル")]),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(e){return t.clickRegist()}}},[t._v("登録")])],1)],1)],1)],2)}),[],!1,null,"035d2fc2",null);e.default=component.exports;y()(component,{VBtn:_.a,VCard:k.a,VCardActions:w.a,VCardText:w.b,VCardTitle:w.c,VContainer:C.a,VDataTable:F.a,VDialog:P.a,VFileInput:I.a,VIcon:R.a,VProgressLinear:T.a,VSimpleTable:V.a,VSpacer:D.a,VTextField:N.a})}}]);