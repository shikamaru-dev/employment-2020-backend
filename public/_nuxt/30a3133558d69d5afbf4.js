(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{447:function(e,t,n){"use strict";n.r(t);n(39),n(43);var r,c,o,l,d=n(15),m=n(52),h={data:function(){return{nexts:[],usersMap:{},departmentsMap:{},departments:[],users:[],department:null,user:null,loading:!1,dialog:!1}},asyncData:(l=Object(d.a)(regeneratorRuntime.mark((function e(){var t,n,r,c,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.functions().httpsCallable("users")({userIds:[]});case 2:return t=e.sent,n=t.data.users,r={},c={},o=[],n.map((function(e){r[e.uid]=e})),e.next=10,m.a.firestore().collection("departments").get();case 10:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,o.push(t),c[e.id]=t})),l=[],e.next=15,m.a.firestore().collection("nexts").get();case 15:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,t.departmentName=c[t.department.id].name,t.displayName=r[t.user.id].displayName,l.push(t)})),e.abrupt("return",{nexts:l,usersMap:r,departmentsMap:c,departments:o,users:n});case 18:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),methods:{openDialog:function(data){data?(this.user={uid:data.user.id,displayName:data.displayName},this.department={name:data.departmentName,id:data.id}):this.clearData(),this.dialog=!0},clickCancel:function(){this.clearData(),this.dialog=!1},clickRegist:(o=Object(d.a)(regeneratorRuntime.mark((function e(){var t,n,r,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,t=m.a.firestore().collection("nexts"),n=m.a.firestore().collection("departments").doc(this.department.id),r=m.a.firestore().collection("users").doc(this.user.uid),!this.department||!this.user){e.next=7;break}return e.next=7,t.doc(this.department.id).set({department:n,user:r}).then((function(e){c.resolveData()})).catch((function(e){alert(e)}));case 7:this.clearData(),this.dialog=!1,this.loading=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),clickDelete:(c=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.dialog=!0,e.next=4,m.a.firestore().collection("nexts").doc(t).delete();case 4:return e.next=6,this.resolveData();case 6:this.dialog=!1,this.loading=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)}),resolveData:(r=Object(d.a)(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,m.a.firestore().collection("nexts").get();case 3:e.sent.forEach((function(e){var r=e.data();r.id=e.id,r.departmentName=n.departmentsMap[r.department.id].name,r.displayName=n.usersMap[r.user.id].displayName,t.push(r)})),this.nexts=t;case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)}),clearData:function(){this.department=null,this.user=null}}},v=n(62),f=n(83),x=n.n(f),k=n(133),_=n(350),w=n(327),y=n(320),D=n(431),N=n(125),V=n(352),C=n(361),R=n(338),j=n(324),component=Object(v.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("h1",[e._v("翌日の部門割当")]),n("v-simple-table",[n("tr",[n("th",[e._v("担当箇所名")]),n("th",[e._v("ユーザー名")])]),e._l(e.nexts,(function(t){return n("tr",{key:t.id},[n("td",[e._v(e._s(t.departmentName))]),n("td",[e._v(e._s(t.displayName))]),n("td",[n("v-btn",{attrs:{small:""},on:{click:function(n){return n.stopPropagation(),e.openDialog(t)}}},[n("v-icon",[e._v("mdi-pencil")])],1)],1),n("td",[n("v-btn",{attrs:{small:""},on:{click:function(n){return n.stopPropagation(),e.clickDelete(t.id)}}},[n("v-icon",[e._v("mdi-delete")])],1)],1)])}))],2),n("v-btn",{attrs:{color:"red",dark:"",fixed:"",bottom:"",right:"",fab:""},on:{click:function(t){return t.stopPropagation(),e.openDialog()}}},[n("v-icon",[e._v("mdi-plus")])],1),n("v-dialog",{attrs:{"max-width":"720",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-title",[n("div",{staticClass:"headline"},[e._v("登録/編集")])]),e.loading?e._e():n("v-card-text",[n("v-container",[n("v-select",{attrs:{items:e.departments,label:"担当部門","item-text":"name","item-value":"id","return-object":""},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),n("v-select",{attrs:{items:e.users,label:"担当者","item-text":"displayName","item-value":"uid","return-object":""},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1)],1),e.loading?n("v-card-text",[e._v("Please stand by"),n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1):e._e(),e.loading?e._e():n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickCancel()}}},[e._v("キャンセル")]),n("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickRegist()}}},[e._v("登録")])],1)],1)],1)],1)}),[],!1,null,"172210c7",null);t.default=component.exports;x()(component,{VBtn:k.a,VCard:_.a,VCardActions:w.a,VCardText:w.b,VCardTitle:w.c,VContainer:y.a,VDialog:D.a,VIcon:N.a,VProgressLinear:V.a,VSelect:C.a,VSimpleTable:R.a,VSpacer:j.a})}}]);