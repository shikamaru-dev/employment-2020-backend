(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{446:function(e,t,r){"use strict";r.r(t);r(18),r(39),r(43);var n,o,c,l,d=r(15),m=r(52),v={data:function(){return{nexts:[],usersMap:{},departmentsMap:{},departments:[],users:[],department:null,user:null,approval:0,loading:!1,dialog:!1}},asyncData:(l=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.functions().httpsCallable("users")({userIds:[]});case 2:return t=e.sent,r=t.data.users,n={},o={},c=[],r.map((function(e){n[e.uid]=e})),e.next=10,m.a.firestore().collection("departments").get();case 10:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,c.push(t),o[e.id]=t})),l=[],e.next=15,m.a.firestore().collection("nextRequests").get();case 15:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,t.departmentName=o[t.department.id].name,t.displayName=n[t.user.id].displayName,t.requestUserName=n[t.requestUser.id].displayName,l.push(t)})),e.abrupt("return",{nexts:l,usersMap:n,departmentsMap:o,departments:c,users:r});case 18:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),methods:{openDialog:function(data){data?(this.user={uid:data.user.id,displayName:data.displayName},this.department={name:data.departmentName,id:data.id}):this.clearData(),this.dialog=!0},clickCancel:function(){this.clearData(),this.dialog=!1},clickRegist:(c=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n,o,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,t=m.a.firestore().collection("nextRequests"),r=m.a.firestore().collection("departments").doc(this.department.id),n=m.a.firestore().collection("users").doc(this.user.uid),o=m.a.firestore().collection("users").doc(this.$store.getters.getUserId),!this.department||!this.user){e.next=8;break}return e.next=8,t.doc(this.department.id).set({department:r,user:n,requestUser:o,approval:Number(this.approval)}).then((function(e){c.resolveData()})).catch((function(e){alert(e)}));case 8:this.clearData(),this.dialog=!1,this.loading=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)}),clickDelete:(o=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.dialog=!0,e.next=4,m.a.firestore().collection("nextRequests").doc(t).delete();case 4:return e.next=6,this.resolveData();case 6:this.dialog=!1,this.loading=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),resolveData:(n=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,m.a.firestore().collection("nextRequests").get();case 3:e.sent.forEach((function(e){var n=e.data();n.id=e.id,n.departmentName=r.departmentsMap[n.department.id].name,n.displayName=r.usersMap[n.user.id].displayName,n.requestUserName=r.usersMap[n.requestUser.id].displayName,t.push(n)})),this.nexts=t;case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),clearData:function(){this.department=null,this.user=null}}},h=r(62),f=r(83),x=r.n(f),k=r(133),_=r(350),y=r(327),N=r(320),w=r(431),D=r(125),R=r(352),V=r(361),C=r(338),j=r(324),M=r(339),component=Object(h.a)(v,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("h1",[e._v("翌営業日のリクエスト")]),r("v-simple-table",[r("tr",[r("th",[e._v("部門名")]),r("th",[e._v("ユーザー名")]),r("th",[e._v("リクエストユーザー名")]),r("th",[e._v("Approval")])]),e._l(e.nexts,(function(t){return r("tr",{key:t.id},[r("td",[e._v(e._s(t.departmentName))]),r("td",[e._v(e._s(t.displayName))]),r("td",[e._v(e._s(t.requestUserName))]),r("td",[e._v(e._s(t.approval))]),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),e.openDialog(t)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),e.clickDelete(t.id)}}},[r("v-icon",[e._v("mdi-delete")])],1)],1)])}))],2),r("v-btn",{attrs:{color:"red",dark:"",fixed:"",bottom:"",right:"",fab:""},on:{click:function(t){return t.stopPropagation(),e.openDialog()}}},[r("v-icon",[e._v("mdi-plus")])],1),r("v-dialog",{attrs:{"max-width":"720",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",[r("div",{staticClass:"headline"},[e._v("登録/編集")])]),e.loading?e._e():r("v-card-text",[r("v-container",[r("v-select",{attrs:{items:e.departments,label:"担当部門","item-text":"name","item-value":"id","return-object":""},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),r("v-select",{attrs:{items:e.users,label:"担当者","item-text":"displayName","item-value":"uid","return-object":""},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}}),r("v-text-field",{attrs:{type:"number",label:"承認フラグ",hint:"0=未チェック,1=承認,2=拒否",required:""},model:{value:e.approval,callback:function(t){e.approval=t},expression:"approval"}})],1)],1),e.loading?r("v-card-text",[e._v("Please stand by"),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1):e._e(),e.loading?e._e():r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickCancel()}}},[e._v("キャンセル")]),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickRegist()}}},[e._v("登録")])],1)],1)],1)],1)}),[],!1,null,"ce9f421c",null);t.default=component.exports;x()(component,{VBtn:k.a,VCard:_.a,VCardActions:y.a,VCardText:y.b,VCardTitle:y.c,VContainer:N.a,VDialog:w.a,VIcon:D.a,VProgressLinear:R.a,VSelect:V.a,VSimpleTable:C.a,VSpacer:j.a,VTextField:M.a})}}]);