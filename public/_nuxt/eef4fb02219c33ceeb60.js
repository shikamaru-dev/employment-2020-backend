(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{442:function(e,t,r){"use strict";r.r(t);r(39),r(43);var n,c,o,l,d=r(15),m=r(52),h={data:function(){return{currents:[],usersMap:{},departmentsMap:{},departments:[],users:[],department:null,user:null,loading:!1,dialog:!1}},asyncData:(l=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n,c,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.functions().httpsCallable("users")({userIds:[]});case 2:return t=e.sent,r=t.data.users,n={},c={},o=[],r.map((function(e){n[e.uid]=e})),e.next=10,m.a.firestore().collection("departments").get();case 10:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,o.push(t),c[e.id]=t})),l=[],e.next=15,m.a.firestore().collection("currents").get();case 15:return e.sent.forEach((function(e){var t=e.data();t.id=e.id,t.departmentName=c[t.department.id].name,t.displayName=n[t.user.id].displayName,l.push(t)})),e.abrupt("return",{currents:l,usersMap:n,departmentsMap:c,departments:o,users:r});case 18:case"end":return e.stop()}}),e)}))),function(){return l.apply(this,arguments)}),methods:{openDialog:function(data){data?(this.user={uid:data.user.id,displayName:data.displayName},this.department={name:data.departmentName,id:data.id}):this.clearData(),this.dialog=!0},clickCancel:function(){this.clearData(),this.dialog=!1},clickRegist:(o=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r,n,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,t=m.a.firestore().collection("currents"),r=m.a.firestore().collection("departments").doc(this.department.id),n=m.a.firestore().collection("users").doc(this.user.uid),!this.department||!this.user){e.next=7;break}return e.next=7,t.doc(this.department.id).set({department:r,user:n}).then((function(e){c.resolveData()})).catch((function(e){alert(e)}));case 7:this.clearData(),this.dialog=!1,this.loading=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),clickDelete:(c=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.dialog=!0,e.next=4,m.a.firestore().collection("currents").doc(t).delete();case 4:return e.next=6,this.resolveData();case 6:this.dialog=!1,this.loading=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)}),resolveData:(n=Object(d.a)(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,m.a.firestore().collection("currents").get();case 3:e.sent.forEach((function(e){var n=e.data();n.id=e.id,n.departmentName=r.departmentsMap[n.department.id].name,n.displayName=r.usersMap[n.user.id].displayName,t.push(n)})),this.currents=t;case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),clearData:function(){this.department=null,this.user=null}}},v=r(62),f=r(83),k=r.n(f),x=r(133),_=r(350),w=r(327),y=r(320),D=r(431),N=r(125),V=r(352),C=r(361),R=r(338),j=r(324),component=Object(v.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("h1",[e._v("本日の該当部門")]),r("v-simple-table",[r("tr",[r("th",[e._v("担当箇所名")]),r("th",[e._v("ユーザー名")])]),e._l(e.currents,(function(t){return r("tr",{key:t.id},[r("td",[e._v(e._s(t.departmentName))]),r("td",[e._v(e._s(t.displayName))]),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),e.openDialog(t)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1),r("td",[r("v-btn",{attrs:{small:""},on:{click:function(r){return r.stopPropagation(),e.clickDelete(t.id)}}},[r("v-icon",[e._v("mdi-delete")])],1)],1)])}))],2),r("v-btn",{attrs:{color:"red",dark:"",fixed:"",bottom:"",right:"",fab:""},on:{click:function(t){return t.stopPropagation(),e.openDialog()}}},[r("v-icon",[e._v("mdi-plus")])],1),r("v-dialog",{attrs:{"max-width":"720",persistent:""},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",[r("div",{staticClass:"headline"},[e._v("登録/編集")])]),e.loading?e._e():r("v-card-text",[r("v-container",[r("v-select",{attrs:{items:e.departments,label:"掃除区域","item-text":"name","item-value":"id","return-object":""},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),r("v-select",{attrs:{items:e.users,label:"担当者","item-text":"displayName","item-value":"uid","return-object":""},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1)],1),e.loading?r("v-card-text",[e._v("Please stand by"),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1):e._e(),e.loading?e._e():r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickCancel()}}},[e._v("キャンセル")]),r("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(t){return e.clickRegist()}}},[e._v("登録")])],1)],1)],1)],1)}),[],!1,null,"01b33869",null);t.default=component.exports;k()(component,{VBtn:x.a,VCard:_.a,VCardActions:w.a,VCardText:w.b,VCardTitle:w.c,VContainer:y.a,VDialog:D.a,VIcon:N.a,VProgressLinear:V.a,VSelect:C.a,VSimpleTable:R.a,VSpacer:j.a})}}]);